!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var r in i)("object"==typeof exports?exports:t)[r]=i[r]}}(this,function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";function r(t){return t=Math.abs(t),Math.random()*t*2-t}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,i,r,n){this.particleList=[],this.pool=[],this.frameTime=0,this.$stopping=!1,this.$stopped=!0,n&&(this.canvasWidth=n.width,this.canvasHeight=n.height),this.ctx=r,this.changeTexture(t,e),this.changeConfig(i),this.createParticlePool()}return t.prototype.changeConfig=function(t){this.gravityX=t.gravity.x,this.gravityY=t.gravity.y,this.emitterX=t.emitterX,this.emitterXVariance=t.emitterXVariance,this.emitterYVariance=t.emitterYVariance,this.emitterY=t.emitterY,this.lifespan=t.lifespan,this.maxParticles=t.maxParticles,this.speed=t.speed,this.angle=t.angle,this.angleVariance=t.angleVariance,this.endRotation=t.endRotation,this.endRotationVariance=t.endRotationVariance,this.startSize=t.startSize,this.startSizeVariance=t.startSizeVariance,this.emissionRate=this.lifespan/this.maxParticles},t.prototype.createParticlePool=function(){for(var t=0;t<this.maxParticles;t++)this.pool.push(new a)},t.prototype.addOneParticle=function(){var t;(t=this.pool.length?this.pool.pop():new a).setTextureInfo(this.texture,{width:this.textureWidth,height:this.textureHeight}),this.initParticle(t),this.particleList.push(t)},t.prototype.removeOneParticle=function(t){var e=this.particleList.indexOf(t);this.particleList.splice(e,1),t.texture=null,this.pool.push(t)},t.prototype.initParticle=function(t){t.currentTime=0,t.lifespan=this.lifespan,t.x=this.emitterX+r(this.emitterXVariance),t.y=this.emitterY+r(this.emitterYVariance),t.endRotation=this.endRotation+r(this.endRotationVariance);var e=this.angle+r(this.angleVariance);return t.velocityX=this.speed*Math.cos(e),t.velocityY=this.speed*Math.sin(e),t.startSize=this.startSize+r(this.startSizeVariance),t.startSize<0&&(t.startSize=.01),t.scale=t.startSize/this.startSize,t},t.prototype.updateParticle=function(t,e){e/=1e3,t.velocityX+=this.gravityX*t.scale*e,t.velocityY+=this.gravityY*t.scale*e,t.x+=t.velocityX*e,t.y+=t.velocityY*e},t.prototype.update=function(t){var e=this;if(!this.$stopping)for(this.frameTime+=t;this.frameTime>0;)this.particleList.length<this.maxParticles&&this.addOneParticle(),this.frameTime-=this.emissionRate;this.particleList.slice().forEach(function(i){i.currentTime<i.lifespan?(e.updateParticle(i,t),i.currentTime+=t):(e.removeOneParticle(i),e.$stopping&&0===e.particleList.length&&(e.$stopped=!0,e.onstopped&&e.onstopped()))})},t.prototype.render=function(t,e){if(void 0===e&&(e=!1),this.update(t),void 0!==this.ctx.draw)e?(this.draw(),this.ctx.draw()):(this.draw(),this.ctx.draw(!0));else if(e){var i=void 0,r=void 0;this.canvasWidth?(i=this.canvasWidth,r=this.canvasHeight):this.ctx.canvas&&(i=this.ctx.canvas.width,r=this.ctx.canvas.width),this.ctx.clearRect(0,0,i,r),this.draw()}else this.draw()},t.prototype.draw=function(){var t=this;this.particleList.forEach(function(e){var i=e.texture,r=e.x,n=e.y,a=e.width,o=e.height,s=e.alpha,c=e.rotation,h=a/2,p=o/2;t.ctx.save(),t.ctx.translate(r+h,n+p),t.ctx.rotate(c),1!==s?(t.ctx.globalAlpha=s,t.ctx.drawImage(i,-h,-p,a,o)):t.ctx.drawImage(i,-h,-p,a,o),t.ctx.restore()})},t.prototype.changeTexture=function(t,e){this.texture=t,this.textureWidth=e.width,this.textureHeight=e.height},t.prototype.circleDraw=function(t){var e=this;this.$stopped||(this.render(t,!0),"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(function(){var t=Date.now();e.circleDraw(t-e.lastTime),e.lastTime=t}):setTimeout(function(){var t=Date.now();e.circleDraw(t-e.lastTime),e.lastTime=t},17))},t.prototype.circleData=function(t,e){var i=this;if(!this.$stopped){this.update(t);var r=this.particleList.map(function(t){return{texture:t.texture,x:t.x,y:t.y,width:t.width,height:t.height,alpha:t.alpha,rotation:t.rotation}});e(r),"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(function(){var t=Date.now();i.circleData(t-i.lastTime,e),i.lastTime=t}):setTimeout(function(){var t=Date.now();i.circleData(t-i.lastTime,e),i.lastTime=t},17)}},t.prototype.start=function(){this.$stopping=!1,this.$stopped&&(this.lastTime=Date.now(),this.$stopped=!1,this.circleDraw(0))},t.prototype.stop=function(){this.$stopping=!0},Object.defineProperty(t.prototype,"isStop",{get:function(){return this.$stopped},enumerable:!0,configurable:!0}),t.prototype.startOnlyData=function(t){this.$stopping=!1,this.$stopped&&(this.lastTime=Date.now(),this.$stopped=!1,this.circleData(0,t))},t}();e.ParticleSystem=n;var a=function(){function t(){}return Object.defineProperty(t.prototype,"startSize",{get:function(){return this._startSize},set:function(t){this._startSize=t,this._width=t,this._height=t/this.ratio},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"progress",{get:function(){return this.currentTime/this.lifespan},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){var t=this.progress;if(t>.8){var e=(1-t)/.2;return e>0?e:0}return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.endRotation*this.progress},enumerable:!0,configurable:!0}),t.prototype.setTextureInfo=function(t,e){this.texture=t,this.ratio=e.width/e.height},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t}();e.default=n}])});
//# sourceMappingURL=ParticleSystem.js.map